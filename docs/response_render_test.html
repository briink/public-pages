<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Renderer Test Page</title>
        <style>
            :root {
                --bg-color: #1a1d21;
                --card-bg: #22262b;
                --text-color: #e8eaed;
                --text-muted: #9aa0a6;
                --border-color: #3c4043;
                --accent-color: #8ab4f8;
            }

            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    sans-serif;
                background-color: var(--bg-color);
                color: var(--text-color);
                padding: 16px;
                line-height: 1.5;
            }

            .test-container {
                max-width: 1600px;
                margin: 0 auto;
            }

            h1 {
                font-size: 20px;
                margin-bottom: 16px;
                color: var(--accent-color);
            }

            .controls {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
                margin-bottom: 16px;
                padding: 12px;
                background-color: var(--card-bg);
                border-radius: 8px;
                border: 1px solid var(--border-color);
            }

            .controls button {
                padding: 8px 16px;
                background-color: var(--accent-color);
                color: #1a1d21;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 13px;
                font-weight: 500;
            }

            .controls button:hover {
                background-color: #a8c7fa;
            }

            .controls button.active {
                background-color: #81c995;
            }

            .renderer-frame {
                width: 100%;
                height: 800px;
                border: 1px solid var(--border-color);
                border-radius: 8px;
                background-color: var(--bg-color);
            }

            .section-label {
                font-size: 11px;
                text-transform: uppercase;
                color: var(--text-muted);
                margin-right: 12px;
                letter-spacing: 0.5px;
            }
        </style>
    </head>
    <body>
        <div class="test-container">
            <h1>Renderer Test Page</h1>

            <div class="controls">
                <span class="section-label">Test Data:</span>
                <button onclick="sendTableResponse()">Table Response</button>
                <button onclick="sendTableResponseWithRefs()">
                    Table + References
                </button>
                <button onclick="sendEQAAnswer()">EQA Answer</button>
                <button onclick="sendEQAListAnswer()">EQA List Answer</button>
                <button onclick="sendEQAWithChoices()">EQA + Choices</button>
                <button onclick="sendDocumentsList()">Documents List</button>
                <button onclick="clearRenderer()">Clear</button>
            </div>

            <iframe
                id="renderer"
                class="renderer-frame"
                src="response_render.html"
            ></iframe>
        </div>

        <script>
            const rendererFrame = document.getElementById("renderer");

            function sendToRenderer(type, data, metadata = {}) {
                rendererFrame.contentWindow.postMessage(
                    {
                        type: type,
                        data: data,
                        metadata: metadata,
                    },
                    "*",
                );
            }

            function clearRenderer() {
                rendererFrame.src = rendererFrame.src; // Reload iframe
            }

            // Test: Table Response with choice-type questions (including multi-select)
            function sendTableResponse() {
                sendToRenderer(
                    "output",
                    {
                        column_headers: [
                            "Has Climate Target",
                            "Target Types",
                            "Board Composition",
                        ],
                        rows: [
                            [
                                "Yes",
                                "- Science-based\n- Net-zero",
                                "- Executive directors\n- Non-executive directors\n- Independent directors",
                            ],
                            [
                                "Yes",
                                "- Net-zero\n- Carbon neutral",
                                "- Executive directors\n- Independent directors",
                            ],
                            ["No", "N/A", "- Executive directors"],
                        ],
                        reasoning: [
                            [
                                "Climate targets disclosed in sustainability report [^0^]",
                                "Both SBTi validated and net-zero targets mentioned [^0^]",
                                "Full board composition described in governance section [^1^]",
                            ],
                            [
                                "Net-zero commitment stated in press release [^1^]",
                                "Dual commitment to net-zero and carbon neutrality [^0^] [^1^]",
                                "Two types of directors identified in filing [^1^]",
                            ],
                            [
                                "No formal climate targets found in disclosures",
                                "Not applicable as no targets set",
                                "Only executive directors on the board",
                            ],
                        ],
                        source_documents: [
                            {
                                page_content:
                                    "Climate Commitment: We have committed to achieving net-zero greenhouse gas emissions by 2050, with science-based interim targets validated by SBTi. We also pursue carbon neutrality for our direct operations.",
                                metadata: {
                                    file_name: "sustainability-report-2023.pdf",
                                    page: 28,
                                    file_id: "sust-2023-climate",
                                },
                            },
                            {
                                page_content:
                                    "Board Composition: Our board consists of executive directors who manage day-to-day operations, non-executive directors who provide strategic guidance, and independent non-executive directors who ensure corporate governance standards are met.",
                                metadata: {
                                    file_name: "governance-report-2023.pdf",
                                    page: 12,
                                    file_id: "gov-2023-board",
                                },
                            },
                        ],
                    },
                    {
                        inputs: {
                            table_question: {
                                text: "Assess climate commitments and board composition for each company",
                                cell_questions: [
                                    {
                                        text: "Has the company set climate-related targets?",
                                        data_type: "choice",
                                        choices: [
                                            {
                                                label: "Yes",
                                                description:
                                                    "Climate targets have been disclosed",
                                            },
                                            {
                                                label: "No",
                                                description:
                                                    "No climate targets found",
                                            },
                                            {
                                                label: "Partial",
                                                description:
                                                    "Some targets but incomplete",
                                            },
                                        ],
                                    },
                                    {
                                        text: "What types of climate targets have been set? (Select all that apply)",
                                        data_type: "multi_choice",
                                        choices: [
                                            {
                                                label: "Science-based",
                                                description:
                                                    "SBTi validated or aligned",
                                            },
                                            {
                                                label: "Net-zero",
                                                description:
                                                    "Net-zero commitment",
                                            },
                                            {
                                                label: "Carbon neutral",
                                                description:
                                                    "Carbon neutrality target",
                                            },
                                            {
                                                label: "N/A",
                                                description: "Not applicable",
                                            },
                                        ],
                                    },
                                    {
                                        text: "What types of directors is the board comprised of? (Select all that apply)",
                                        data_type: "multi_choice",
                                        choices: [
                                            {
                                                label: "Executive directors",
                                                description:
                                                    "Directors involved in day-to-day management",
                                            },
                                            {
                                                label: "Non-executive directors",
                                                description:
                                                    "Directors not involved in daily operations",
                                            },
                                            {
                                                label: "Independent directors",
                                                description:
                                                    "Directors with no material relationship to company",
                                            },
                                        ],
                                    },
                                ],
                            },
                        },
                    },
                );
            }

            // Test: Table Response with inline references and multi-select questions
            function sendTableResponseWithRefs() {
                sendToRenderer(
                    "output",
                    {
                        column_headers: [
                            "Board Independence",
                            "Committee Types",
                            "Stakeholder Engagement",
                        ],
                        rows: [
                            [
                                "Yes [^0^]",
                                "- Audit\n- Compensation\n- Nomination [^1^]",
                                "- Shareholders\n- Employees\n- Communities [^0^]",
                            ],
                            [
                                "Partial [^1^]",
                                "- Audit\n- Risk [^0^]",
                                "- Shareholders\n- Customers",
                            ],
                            ["No [^99^]", "- Audit", "- Shareholders"],
                        ],
                        reasoning: [
                            [
                                "Board independence confirmed in governance report [^0^]",
                                "Multiple committees described in charter [^1^]",
                                "Comprehensive stakeholder engagement program [^0^]",
                            ],
                            [
                                "Some independent directors but not majority [^1^]",
                                "Two key committees identified [^0^]",
                                "Limited stakeholder engagement focus",
                            ],
                            [
                                "Invalid reference test [^99^]",
                                "Only basic audit committee",
                                "Minimal stakeholder engagement",
                            ],
                        ],
                        source_documents: [
                            {
                                page_content:
                                    "Corporate Governance Report: The board maintains a majority of independent directors. We engage with shareholders, employees, and local communities through regular dialogue and feedback mechanisms.",
                                metadata: {
                                    file_name: "governance-report-2023.pdf",
                                    page: 15,
                                    file_id: "gov-2023-001",
                                },
                            },
                            {
                                page_content:
                                    "Committee Structure: The board has established an Audit Committee, Compensation Committee, and Nomination Committee, each comprised of independent directors.",
                                metadata: {
                                    file_name: "committee-charters.pdf",
                                    page: 2,
                                    file_id: "committees-2023",
                                },
                            },
                        ],
                    },
                    {
                        inputs: {
                            table_question: {
                                text: "Evaluate corporate governance and stakeholder engagement",
                                cell_questions: [
                                    {
                                        text: "Does the board have a majority of independent directors?",
                                        data_type: "choice",
                                        choices: [
                                            {
                                                label: "Yes",
                                                description:
                                                    "Majority independent",
                                            },
                                            {
                                                label: "No",
                                                description:
                                                    "Not majority independent",
                                            },
                                            {
                                                label: "Partial",
                                                description:
                                                    "Some independent directors",
                                            },
                                        ],
                                    },
                                    {
                                        text: "What board committees exist? (Select all that apply)",
                                        data_type: "multi_choice",
                                        choices: [
                                            {
                                                label: "Audit",
                                                description:
                                                    "Audit/Finance committee",
                                            },
                                            {
                                                label: "Compensation",
                                                description:
                                                    "Compensation/Remuneration committee",
                                            },
                                            {
                                                label: "Nomination",
                                                description:
                                                    "Nomination/Governance committee",
                                            },
                                            {
                                                label: "Risk",
                                                description:
                                                    "Risk management committee",
                                            },
                                            {
                                                label: "Sustainability",
                                                description:
                                                    "ESG/Sustainability committee",
                                            },
                                        ],
                                    },
                                    {
                                        text: "Which stakeholders does the company engage with? (Select all that apply)",
                                        data_type: "multi_choice",
                                        choices: [
                                            {
                                                label: "Shareholders",
                                                description:
                                                    "Investors and shareholders",
                                            },
                                            {
                                                label: "Employees",
                                                description:
                                                    "Workforce engagement",
                                            },
                                            {
                                                label: "Customers",
                                                description:
                                                    "Customer engagement",
                                            },
                                            {
                                                label: "Communities",
                                                description:
                                                    "Local community engagement",
                                            },
                                            {
                                                label: "Suppliers",
                                                description:
                                                    "Supply chain engagement",
                                            },
                                        ],
                                    },
                                ],
                            },
                        },
                    },
                );
            }

            // Test: EQA Answer (simple)
            function sendEQAAnswer() {
                sendToRenderer(
                    "output",
                    {
                        response_text:
                            "The company reported a 15% increase in revenue year-over-year, reaching $1.2 billion in fiscal year 2023. [^0^]",
                        reasoning:
                            "Based on the annual report page 45, the revenue figures show consistent growth. The data is verified across multiple sources [^0^] [^1^].",
                        source_documents: [
                            {
                                page_content:
                                    "Fiscal Year 2023 Results: Revenue increased 15% to $1.2 billion compared to $1.04 billion in FY2022.",
                                metadata: {
                                    file_name: "annual-report-2023.pdf",
                                    page: 45,
                                    file_id: "ar-2023-rev-001",
                                },
                            },
                            {
                                page_content:
                                    "Revenue Growth Analysis: The 15% growth was driven primarily by expansion in APAC markets and new product launches.",
                                metadata: {
                                    file_name: "investor-presentation.pdf",
                                    page: 12,
                                    file_id: "inv-pres-2023",
                                },
                            },
                        ],
                    },
                    {
                        inputs: {
                            question: {
                                text: "What was the company's revenue growth in fiscal year 2023?",
                                data_type: "text",
                            },
                        },
                    },
                );
            }

            // Test: EQA Answer with dash-delimited list response
            function sendEQAListAnswer() {
                sendToRenderer(
                    "output",
                    {
                        response_text:
                            "- Executive directors or equivalent\n- Non-executive directors or equivalent\n- Independent non-executive directors or equivalent",
                        reasoning:
                            "The board composition is described in the corporate governance section [^0^]. The report clearly identifies three types of directors serving on the board.",
                        source_documents: [
                            {
                                page_content:
                                    "Board Composition: Our board consists of executive directors who manage day-to-day operations, non-executive directors who provide independent oversight, and independent non-executive directors who ensure corporate governance standards.",
                                metadata: {
                                    file_name: "corporate-governance-2023.pdf",
                                    page: 12,
                                    file_id: "cg-2023-board",
                                },
                            },
                        ],
                    },
                    {
                        inputs: {
                            question: {
                                text: "What types of directors is your board or equivalent comprised of?",
                                data_type: "text",
                            },
                        },
                    },
                );
            }

            // Test: EQA with choices and embedded reasoning
            function sendEQAWithChoices() {
                sendToRenderer(
                    "output",
                    {
                        response_text: "Yes",
                        reasoning:
                            "<<Yes>> The company has set science-based targets and committed to net-zero by 2050 [^0^]. They have published detailed transition plans. <<No>> This would only apply if no targets were disclosed, but targets are clearly stated in the sustainability report [^1^].",
                        choices: [
                            { label: "Yes", is_selected: true },
                            { label: "No", is_selected: false },
                            { label: "Partial", is_selected: false },
                        ],
                        source_documents: [
                            {
                                page_content:
                                    "Climate Commitment: We have committed to achieving net-zero greenhouse gas emissions by 2050, with an interim target of 50% reduction by 2030.",
                                metadata: {
                                    file_name: "sustainability-report-2023.pdf",
                                    page: 28,
                                    file_id: "sust-2023-climate",
                                },
                            },
                            {
                                page_content:
                                    "Our science-based targets have been validated by the Science Based Targets initiative (SBTi) and align with a 1.5C pathway.",
                                metadata: {
                                    file_name: "sustainability-report-2023.pdf",
                                    page: 30,
                                    file_id: "sust-2023-sbti",
                                },
                            },
                        ],
                    },
                    {
                        inputs: {
                            question: {
                                text: "Has the company set climate-related targets?",
                                data_type: "choice",
                                choices: [
                                    {
                                        label: "Yes",
                                        description:
                                            "Company has disclosed climate targets",
                                    },
                                    {
                                        label: "No",
                                        description: "No climate targets found",
                                    },
                                    {
                                        label: "Partial",
                                        description:
                                            "Some targets but incomplete",
                                    },
                                ],
                            },
                        },
                    },
                );
            }

            // Test: Documents List
            function sendDocumentsList() {
                sendToRenderer("output", {
                    documents: [
                        {
                            metadata: {
                                characters: 2680,
                                chunk_id: 96,
                                file_name: "2024-sustainability-report.pdf",
                                id: "15241e03-deaf-4e6a-8de0-83b04d61cda5",
                                page: 96,
                            },
                            page_content:
                                "Employee development, training and education\n\nAt Johnson Controls, we support the ongoing development of our people and continue to provide opportunities for our employees to grow their careers.\n\nTotal learning hours consumed: 1.32 million\nAvg. 15 hours per employee\n85,510 employees completed learning activities\n\nIn fiscal year 2023, we offered a robust curriculum of over 197,000 activities.",
                            type: "Document",
                        },
                        {
                            metadata: {
                                characters: 2337,
                                chunk_id: 95,
                                file_name: "2024-sustainability-report.pdf",
                                id: "15241e03-deaf-4e6a-8de0-83b04d61cda5",
                                page: 95,
                            },
                            page_content:
                                "Talent management\n\nAt Johnson Controls, we support the continued development of our employees and have embedded this focus throughout our performance and talent processes.\n\nStrategic talent reviews and succession planning occur annually across our business areas globally.",
                            type: "Document",
                        },
                        {
                            metadata: {
                                characters: 2670,
                                chunk_id: 104,
                                file_name: "2024-sustainability-report.pdf",
                                id: "15241e03-deaf-4e6a-8de0-83b04d61cda5",
                                page: 104,
                            },
                            page_content:
                                "Product safety\n\nOur business is committed to providing quality products and services that meet or exceed the expectations of our customers.\n\nWe're proud to have been recognized by LexisNexis as one of the world's most innovative companies in its latest report, Innovation Momentum 2023: The Global Top 100.",
                            type: "Document",
                        },
                    ],
                });
            }
        </script>
    </body>
</html>
