<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Renderer Test Page</title>
        <style>
            :root {
                --bg-color: #1a1d21;
                --card-bg: #22262b;
                --text-color: #e8eaed;
                --text-muted: #9aa0a6;
                --border-color: #3c4043;
                --accent-color: #8ab4f8;
            }

            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    sans-serif;
                background-color: var(--bg-color);
                color: var(--text-color);
                padding: 16px;
                line-height: 1.5;
            }

            .test-container {
                max-width: 1600px;
                margin: 0 auto;
            }

            h1 {
                font-size: 20px;
                margin-bottom: 16px;
                color: var(--accent-color);
            }

            .controls {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
                margin-bottom: 16px;
                padding: 12px;
                background-color: var(--card-bg);
                border-radius: 8px;
                border: 1px solid var(--border-color);
            }

            .controls button {
                padding: 8px 16px;
                background-color: var(--accent-color);
                color: #1a1d21;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 13px;
                font-weight: 500;
            }

            .controls button:hover {
                background-color: #a8c7fa;
            }

            .controls button.active {
                background-color: #81c995;
            }

            .renderer-frame {
                width: 100%;
                height: 800px;
                border: 1px solid var(--border-color);
                border-radius: 8px;
                background-color: var(--bg-color);
            }

            .section-label {
                font-size: 11px;
                text-transform: uppercase;
                color: var(--text-muted);
                margin-right: 12px;
                letter-spacing: 0.5px;
            }
        </style>
    </head>
    <body>
        <div class="test-container">
            <h1>Renderer Test Page</h1>

            <div class="controls">
                <span class="section-label">Test Data:</span>
                <button onclick="sendTableResponse()">Table Response</button>
                <button onclick="sendTableResponseWithRefs()">
                    Table + References
                </button>
                <button onclick="sendEQAAnswer()">EQA Answer</button>
                <button onclick="sendEQAListAnswer()">EQA List Answer</button>
                <button onclick="sendEQAWithChoices()">EQA + Choices</button>
                <button onclick="sendDocumentsList()">Documents List</button>
                <button onclick="sendLargeTable()">Large Table (4x15)</button>
                <button onclick="sendPerPageAnswer()">
                    PerPageAnswer (LLM)
                </button>
                <button onclick="sendLLMTextResponse()">
                    LLM Text (Markdown)
                </button>
                <button onclick="clearRenderer()">Clear</button>
            </div>

            <iframe
                id="renderer"
                class="renderer-frame"
                src="response_render.html"
            ></iframe>
        </div>

        <script>
            const rendererFrame = document.getElementById("renderer");

            function sendToRenderer(type, data, metadata = {}) {
                rendererFrame.contentWindow.postMessage(
                    {
                        type: type,
                        data: data,
                        metadata: metadata,
                    },
                    "*",
                );
            }

            function clearRenderer() {
                rendererFrame.src = rendererFrame.src; // Reload iframe
            }

            // Test: Table Response with choice-type questions (including multi-select)
            function sendTableResponse() {
                sendToRenderer(
                    "output",
                    {
                        column_headers: [
                            "Has Climate Target",
                            "Target Types",
                            "Board Composition",
                        ],
                        rows: [
                            [
                                "Yes",
                                "- Science-based\n- Net-zero",
                                "- Executive directors\n- Non-executive directors\n- Independent directors",
                            ],
                            [
                                "Yes",
                                "- Net-zero\n- Carbon neutral",
                                "- Executive directors\n- Independent directors",
                            ],
                            ["No", "N/A", "- Executive directors"],
                        ],
                        reasoning: [
                            [
                                "Climate targets disclosed in sustainability report [^0^]",
                                "Both SBTi validated and net-zero targets mentioned [^0^]",
                                "Full board composition described in governance section [^1^]",
                            ],
                            [
                                "Net-zero commitment stated in press release [^1^]",
                                "Dual commitment to net-zero and carbon neutrality [^0^] [^1^]",
                                "Two types of directors identified in filing [^1^]",
                            ],
                            [
                                "No formal climate targets found in disclosures",
                                "Not applicable as no targets set",
                                "Only executive directors on the board",
                            ],
                        ],
                        source_documents: [
                            {
                                page_content:
                                    "Climate Commitment: We have committed to achieving net-zero greenhouse gas emissions by 2050, with science-based interim targets validated by SBTi. We also pursue carbon neutrality for our direct operations.",
                                metadata: {
                                    file_name: "sustainability-report-2023.pdf",
                                    page: 28,
                                    file_id: "sust-2023-climate",
                                },
                            },
                            {
                                page_content:
                                    "Board Composition: Our board consists of executive directors who manage day-to-day operations, non-executive directors who provide strategic guidance, and independent non-executive directors who ensure corporate governance standards are met.",
                                metadata: {
                                    file_name: "governance-report-2023.pdf",
                                    page: 12,
                                    file_id: "gov-2023-board",
                                },
                            },
                        ],
                    },
                    {
                        inputs: {
                            table_question: {
                                text: "Assess climate commitments and board composition for each company",
                                cell_questions: [
                                    {
                                        text: "Has the company set climate-related targets?",
                                        data_type: "choice",
                                        choices: [
                                            {
                                                label: "Yes",
                                                description:
                                                    "Climate targets have been disclosed",
                                            },
                                            {
                                                label: "No",
                                                description:
                                                    "No climate targets found",
                                            },
                                            {
                                                label: "Partial",
                                                description:
                                                    "Some targets but incomplete",
                                            },
                                        ],
                                    },
                                    {
                                        text: "What types of climate targets have been set? (Select all that apply)",
                                        data_type: "multi_choice",
                                        choices: [
                                            {
                                                label: "Science-based",
                                                description:
                                                    "SBTi validated or aligned",
                                            },
                                            {
                                                label: "Net-zero",
                                                description:
                                                    "Net-zero commitment",
                                            },
                                            {
                                                label: "Carbon neutral",
                                                description:
                                                    "Carbon neutrality target",
                                            },
                                            {
                                                label: "N/A",
                                                description: "Not applicable",
                                            },
                                        ],
                                    },
                                    {
                                        text: "What types of directors is the board comprised of? (Select all that apply)",
                                        data_type: "multi_choice",
                                        choices: [
                                            {
                                                label: "Executive directors",
                                                description:
                                                    "Directors involved in day-to-day management",
                                            },
                                            {
                                                label: "Non-executive directors",
                                                description:
                                                    "Directors not involved in daily operations",
                                            },
                                            {
                                                label: "Independent directors",
                                                description:
                                                    "Directors with no material relationship to company",
                                            },
                                        ],
                                    },
                                ],
                            },
                        },
                    },
                );
            }

            // Test: Table Response with inline references and multi-select questions
            function sendTableResponseWithRefs() {
                sendToRenderer(
                    "output",
                    {
                        column_headers: [
                            "Board Independence",
                            "Committee Types",
                            "Stakeholder Engagement",
                        ],
                        rows: [
                            [
                                "Yes [^0^]",
                                "- Audit\n- Compensation\n- Nomination [^1^]",
                                "- Shareholders\n- Employees\n- Communities [^0^]",
                            ],
                            [
                                "Partial [^1^]",
                                "- Audit\n- Risk [^0^]",
                                "- Shareholders\n- Customers",
                            ],
                            ["No [^99^]", "- Audit", "- Shareholders"],
                        ],
                        reasoning: [
                            [
                                "Board independence confirmed in governance report [^0^]",
                                "Multiple committees described in charter [^1^]",
                                "Comprehensive stakeholder engagement program [^0^]",
                            ],
                            [
                                "Some independent directors but not majority [^1^]",
                                "Two key committees identified [^0^]",
                                "Limited stakeholder engagement focus",
                            ],
                            [
                                "Invalid reference test [^99^]",
                                "Only basic audit committee",
                                "Minimal stakeholder engagement",
                            ],
                        ],
                        source_documents: [
                            {
                                page_content:
                                    "Corporate Governance Report: The board maintains a majority of independent directors. We engage with shareholders, employees, and local communities through regular dialogue and feedback mechanisms.",
                                metadata: {
                                    file_name: "governance-report-2023.pdf",
                                    page: 15,
                                    file_id: "gov-2023-001",
                                },
                            },
                            {
                                page_content:
                                    "Committee Structure: The board has established an Audit Committee, Compensation Committee, and Nomination Committee, each comprised of independent directors.",
                                metadata: {
                                    file_name: "committee-charters.pdf",
                                    page: 2,
                                    file_id: "committees-2023",
                                },
                            },
                        ],
                    },
                    {
                        inputs: {
                            table_question: {
                                text: "Evaluate corporate governance and stakeholder engagement",
                                cell_questions: [
                                    {
                                        text: "Does the board have a majority of independent directors?",
                                        data_type: "choice",
                                        choices: [
                                            {
                                                label: "Yes",
                                                description:
                                                    "Majority independent",
                                            },
                                            {
                                                label: "No",
                                                description:
                                                    "Not majority independent",
                                            },
                                            {
                                                label: "Partial",
                                                description:
                                                    "Some independent directors",
                                            },
                                        ],
                                    },
                                    {
                                        text: "What board committees exist? (Select all that apply)",
                                        data_type: "multi_choice",
                                        choices: [
                                            {
                                                label: "Audit",
                                                description:
                                                    "Audit/Finance committee",
                                            },
                                            {
                                                label: "Compensation",
                                                description:
                                                    "Compensation/Remuneration committee",
                                            },
                                            {
                                                label: "Nomination",
                                                description:
                                                    "Nomination/Governance committee",
                                            },
                                            {
                                                label: "Risk",
                                                description:
                                                    "Risk management committee",
                                            },
                                            {
                                                label: "Sustainability",
                                                description:
                                                    "ESG/Sustainability committee",
                                            },
                                        ],
                                    },
                                    {
                                        text: "Which stakeholders does the company engage with? (Select all that apply)",
                                        data_type: "multi_choice",
                                        choices: [
                                            {
                                                label: "Shareholders",
                                                description:
                                                    "Investors and shareholders",
                                            },
                                            {
                                                label: "Employees",
                                                description:
                                                    "Workforce engagement",
                                            },
                                            {
                                                label: "Customers",
                                                description:
                                                    "Customer engagement",
                                            },
                                            {
                                                label: "Communities",
                                                description:
                                                    "Local community engagement",
                                            },
                                            {
                                                label: "Suppliers",
                                                description:
                                                    "Supply chain engagement",
                                            },
                                        ],
                                    },
                                ],
                            },
                        },
                    },
                );
            }

            // Test: EQA Answer (simple)
            function sendEQAAnswer() {
                sendToRenderer(
                    "output",
                    {
                        response_text:
                            "The company reported a 15% increase in revenue year-over-year, reaching $1.2 billion in fiscal year 2023. [^0^]",
                        reasoning:
                            "Based on the annual report page 45, the revenue figures show consistent growth. The data is verified across multiple sources [^0^] [^1^].",
                        source_documents: [
                            {
                                page_content:
                                    "Fiscal Year 2023 Results: Revenue increased 15% to $1.2 billion compared to $1.04 billion in FY2022.",
                                metadata: {
                                    file_name: "annual-report-2023.pdf",
                                    page: 45,
                                    file_id: "ar-2023-rev-001",
                                },
                            },
                            {
                                page_content:
                                    "Revenue Growth Analysis: The 15% growth was driven primarily by expansion in APAC markets and new product launches.",
                                metadata: {
                                    file_name: "investor-presentation.pdf",
                                    page: 12,
                                    file_id: "inv-pres-2023",
                                },
                            },
                        ],
                    },
                    {
                        inputs: {
                            question: {
                                text: "What was the company's revenue growth in fiscal year 2023?",
                                data_type: "text",
                            },
                        },
                    },
                );
            }

            // Test: EQA Answer with dash-delimited list response
            function sendEQAListAnswer() {
                sendToRenderer(
                    "output",
                    {
                        response_text:
                            "- Executive directors or equivalent\n- Non-executive directors or equivalent\n- Independent non-executive directors or equivalent",
                        reasoning:
                            "The board composition is described in the corporate governance section [^0^]. The report clearly identifies three types of directors serving on the board.",
                        source_documents: [
                            {
                                page_content:
                                    "Board Composition: Our board consists of executive directors who manage day-to-day operations, non-executive directors who provide independent oversight, and independent non-executive directors who ensure corporate governance standards.",
                                metadata: {
                                    file_name: "corporate-governance-2023.pdf",
                                    page: 12,
                                    file_id: "cg-2023-board",
                                },
                            },
                        ],
                    },
                    {
                        inputs: {
                            question: {
                                text: "What types of directors is your board or equivalent comprised of?",
                                data_type: "text",
                            },
                        },
                    },
                );
            }

            // Test: EQA with choices and embedded reasoning
            function sendEQAWithChoices() {
                sendToRenderer(
                    "output",
                    {
                        response_text: "Yes",
                        reasoning:
                            "<<Yes>> The company has set science-based targets and committed to net-zero by 2050 [^0^]. They have published detailed transition plans. <<No>> This would only apply if no targets were disclosed, but targets are clearly stated in the sustainability report [^1^].",
                        choices: [
                            { label: "Yes", is_selected: true },
                            { label: "No", is_selected: false },
                            { label: "Partial", is_selected: false },
                        ],
                        source_documents: [
                            {
                                page_content:
                                    "Climate Commitment: We have committed to achieving net-zero greenhouse gas emissions by 2050, with an interim target of 50% reduction by 2030.",
                                metadata: {
                                    file_name: "sustainability-report-2023.pdf",
                                    page: 28,
                                    file_id: "sust-2023-climate",
                                },
                            },
                            {
                                page_content:
                                    "Our science-based targets have been validated by the Science Based Targets initiative (SBTi) and align with a 1.5C pathway.",
                                metadata: {
                                    file_name: "sustainability-report-2023.pdf",
                                    page: 30,
                                    file_id: "sust-2023-sbti",
                                },
                            },
                        ],
                    },
                    {
                        inputs: {
                            question: {
                                text: "Has the company set climate-related targets?",
                                data_type: "choice",
                                choices: [
                                    {
                                        label: "Yes",
                                        description:
                                            "Company has disclosed climate targets",
                                    },
                                    {
                                        label: "No",
                                        description: "No climate targets found",
                                    },
                                    {
                                        label: "Partial",
                                        description:
                                            "Some targets but incomplete",
                                    },
                                ],
                            },
                        },
                    },
                );
            }

            // Test: Documents List
            function sendDocumentsList() {
                sendToRenderer("output", {
                    documents: [
                        {
                            metadata: {
                                characters: 2680,
                                chunk_id: 96,
                                file_name: "2024-sustainability-report.pdf",
                                id: "15241e03-deaf-4e6a-8de0-83b04d61cda5",
                                page: 96,
                            },
                            page_content:
                                "Employee development, training and education\n\nAt Johnson Controls, we support the ongoing development of our people and continue to provide opportunities for our employees to grow their careers.\n\nTotal learning hours consumed: 1.32 million\nAvg. 15 hours per employee\n85,510 employees completed learning activities\n\nIn fiscal year 2023, we offered a robust curriculum of over 197,000 activities.",
                            type: "Document",
                        },
                        {
                            metadata: {
                                characters: 2337,
                                chunk_id: 95,
                                file_name: "2024-sustainability-report.pdf",
                                id: "15241e03-deaf-4e6a-8de0-83b04d61cda5",
                                page: 95,
                            },
                            page_content:
                                "Talent management\n\nAt Johnson Controls, we support the continued development of our employees and have embedded this focus throughout our performance and talent processes.\n\nStrategic talent reviews and succession planning occur annually across our business areas globally.",
                            type: "Document",
                        },
                        {
                            metadata: {
                                characters: 2670,
                                chunk_id: 104,
                                file_name: "2024-sustainability-report.pdf",
                                id: "15241e03-deaf-4e6a-8de0-83b04d61cda5",
                                page: 104,
                            },
                            page_content:
                                "Product safety\n\nOur business is committed to providing quality products and services that meet or exceed the expectations of our customers.\n\nWe're proud to have been recognized by LexisNexis as one of the world's most innovative companies in its latest report, Innovation Momentum 2023: The Global Top 100.",
                            type: "Document",
                        },
                    ],
                });
            }

            // Test: Large 4 rows x 15 columns table with mix of choice and long text
            function sendLargeTable() {
                const columns = [
                    "Has Climate Target",
                    "Target Types",
                    "SBTi Validated",
                    "Carbon Reduction Strategy",
                    "Water Risk Level",
                    "Water Management Approach",
                    "Waste Diversion Rate",
                    "Circular Economy Initiatives",
                    "Renewable Energy %",
                    "Energy Sources",
                    "Board Oversight",
                    "Governance Structure",
                    "Stakeholder Types",
                    "Engagement Methods",
                    "Future Commitments",
                ];

                // Cell question definitions - mix of choice, multi_choice, and text
                const cellQuestions = [
                    {
                        text: "Has the company set climate-related targets?",
                        data_type: "choice",
                        choices: [
                            {
                                label: "Yes",
                                description: "Climate targets disclosed",
                            },
                            { label: "No", description: "No targets found" },
                            {
                                label: "Partial",
                                description: "Some targets but incomplete",
                            },
                        ],
                    },
                    {
                        text: "What types of climate targets? (Select all)",
                        data_type: "multi_choice",
                        choices: [
                            {
                                label: "Science-based",
                                description: "SBTi aligned",
                            },
                            {
                                label: "Net-zero",
                                description: "Net-zero commitment",
                            },
                            {
                                label: "Carbon neutral",
                                description: "Carbon neutrality",
                            },
                            {
                                label: "Intensity-based",
                                description: "Per unit targets",
                            },
                        ],
                    },
                    {
                        text: "Are targets validated by SBTi?",
                        data_type: "choice",
                        choices: [
                            { label: "Yes", description: "SBTi validated" },
                            { label: "No", description: "Not validated" },
                            {
                                label: "Committed",
                                description: "Committed but pending",
                            },
                        ],
                    },
                    {
                        text: "Describe the carbon reduction strategy",
                        data_type: "text",
                    },
                    {
                        text: "What is the water risk level?",
                        data_type: "choice",
                        choices: [
                            {
                                label: "High",
                                description: "High water stress areas",
                            },
                            {
                                label: "Medium",
                                description: "Moderate water risk",
                            },
                            { label: "Low", description: "Low water stress" },
                        ],
                    },
                    {
                        text: "Describe water management approach",
                        data_type: "text",
                    },
                    {
                        text: "What is the waste diversion rate?",
                        data_type: "choice",
                        choices: [
                            {
                                label: ">90%",
                                description: "Excellent diversion",
                            },
                            { label: "70-90%", description: "Good diversion" },
                            {
                                label: "50-70%",
                                description: "Moderate diversion",
                            },
                            { label: "<50%", description: "Low diversion" },
                        ],
                    },
                    {
                        text: "Describe circular economy initiatives",
                        data_type: "text",
                    },
                    {
                        text: "What percentage of energy is renewable?",
                        data_type: "choice",
                        choices: [
                            { label: "100%", description: "Fully renewable" },
                            {
                                label: "75-99%",
                                description: "Mostly renewable",
                            },
                            {
                                label: "50-74%",
                                description: "Majority renewable",
                            },
                            {
                                label: "<50%",
                                description: "Minority renewable",
                            },
                        ],
                    },
                    {
                        text: "What energy sources are used? (Select all)",
                        data_type: "multi_choice",
                        choices: [
                            { label: "Solar", description: "Solar PV" },
                            { label: "Wind", description: "Wind power" },
                            { label: "Hydro", description: "Hydroelectric" },
                            {
                                label: "Natural Gas",
                                description: "Natural gas",
                            },
                            { label: "Grid", description: "Grid electricity" },
                        ],
                    },
                    {
                        text: "Does the board oversee climate issues?",
                        data_type: "choice",
                        choices: [
                            {
                                label: "Yes",
                                description: "Board-level oversight",
                            },
                            { label: "No", description: "No board oversight" },
                            {
                                label: "Committee",
                                description: "Committee level only",
                            },
                        ],
                    },
                    {
                        text: "Describe the governance structure for sustainability",
                        data_type: "text",
                    },
                    {
                        text: "Which stakeholders are engaged? (Select all)",
                        data_type: "multi_choice",
                        choices: [
                            { label: "Investors", description: "Shareholders" },
                            { label: "Employees", description: "Workforce" },
                            {
                                label: "Communities",
                                description: "Local communities",
                            },
                            { label: "Suppliers", description: "Supply chain" },
                            {
                                label: "NGOs",
                                description: "Environmental NGOs",
                            },
                        ],
                    },
                    {
                        text: "Describe stakeholder engagement methods",
                        data_type: "text",
                    },
                    {
                        text: "Describe future sustainability commitments",
                        data_type: "text",
                    },
                ];

                // Row data - 4 companies with varying ESG maturity
                const rows = [
                    // Company Alpha - strong performer
                    [
                        "Yes",
                        "- Science-based\n- Net-zero",
                        "Yes",
                        "The company has implemented a comprehensive carbon reduction program targeting a 45% decrease in Scope 1 and 2 emissions by 2030, with interim targets set for 2025 including fleet electrification, renewable energy procurement, and process efficiency improvements across all manufacturing facilities.",
                        "Medium",
                        "Water stewardship initiatives include closed-loop cooling systems achieving 85% water recycling, rainwater harvesting across 12 facilities, and partnerships with local watershed councils to restore riparian zones in water-stressed operating regions.",
                        ">90%",
                        "Circular economy initiatives have diverted 15,000 tonnes of materials from waste streams through product take-back programs, design-for-recyclability guidelines, and industrial symbiosis partnerships with neighboring facilities.",
                        "75-99%",
                        "- Solar\n- Wind\n- Grid",
                        "Yes",
                        "The board has established a dedicated Sustainability Committee comprising three independent directors who meet quarterly to review climate risks, approve emissions targets, and oversee implementation of the transition plan.",
                        "- Investors\n- Employees\n- Communities\n- NGOs",
                        "Stakeholder engagement includes quarterly investor calls on ESG topics, employee sustainability champions program, community advisory panels near major facilities, and collaborative projects with WWF and local environmental groups.",
                        "By 2030, the company commits to achieving 100% renewable electricity, reducing Scope 3 emissions by 30%, and implementing nature-based solutions across 10,000 hectares of land in partnership with conservation organizations.",
                    ],
                    // Company Beta - moderate performer
                    [
                        "Yes",
                        "- Net-zero\n- Intensity-based",
                        "Committed",
                        "Carbon strategy focuses on operational efficiency improvements and gradual transition to lower-carbon energy sources. The company has set an intensity-based target of 25% reduction per unit of production by 2028, with plans to develop absolute reduction targets.",
                        "High",
                        "Given operations in water-stressed regions, the company has prioritized water efficiency measures including leak detection systems, process water recycling, and drought contingency planning. Total water withdrawal reduced by 15% since 2020.",
                        "70-90%",
                        "Product packaging redesign has reduced plastic use by 40%. The company operates a refurbishment program for returned equipment and partners with recyclers to ensure proper end-of-life management.",
                        "50-74%",
                        "- Solar\n- Natural Gas\n- Grid",
                        "Committee",
                        "Sustainability is overseen by the Risk Committee which reviews environmental matters quarterly. Management has established a cross-functional sustainability working group that reports to the committee on progress against targets.",
                        "- Investors\n- Employees\n- Suppliers",
                        "Annual sustainability report published with GRI alignment. Employee engagement surveys include sustainability questions. Supplier code of conduct requires environmental compliance and reporting.",
                        "The company plans to submit SBTi targets for validation by 2025, achieve 80% renewable electricity by 2028, and expand circular economy programs to cover 100% of product categories.",
                    ],
                    // Company Gamma - developing
                    [
                        "Partial",
                        "- Intensity-based",
                        "No",
                        "The company has begun developing its climate strategy with initial focus on energy efficiency and emissions measurement. A cross-functional team is working to establish baseline emissions data and evaluate target-setting frameworks.",
                        "Low",
                        "Water management practices include standard compliance monitoring and basic efficiency measures. The company is evaluating opportunities for water recycling and has committed to conducting a water risk assessment.",
                        "50-70%",
                        "Recycling programs are in place at major facilities. The company is exploring circular economy opportunities and has piloted a product refurbishment program in one market.",
                        "<50%",
                        "- Natural Gas\n- Grid",
                        "No",
                        "Environmental matters are managed at the operational level with periodic reporting to senior management. The company is evaluating options for enhanced board-level oversight of sustainability issues.",
                        "- Investors\n- Employees",
                        "The company responds to investor ESG questionnaires and includes sustainability updates in annual reports. Employee communications cover environmental initiatives and energy-saving tips.",
                        "Over the next three years, the company plans to complete comprehensive emissions baselining, establish science-aligned targets, and develop a formal climate transition roadmap.",
                    ],
                    // Company Delta - early stage
                    [
                        "No",
                        "N/A",
                        "No",
                        "The company has not yet established formal climate targets but recognizes the importance of addressing climate change. Initial steps include energy audits at key facilities and preliminary discussions on sustainability strategy.",
                        "Medium",
                        "Standard water management practices are in place to ensure regulatory compliance. The company monitors water usage at major facilities and implements basic conservation measures.",
                        "<50%",
                        "Basic recycling programs exist at corporate offices. The company is beginning to explore circular economy concepts and their potential application to business operations.",
                        "<50%",
                        "- Grid",
                        "No",
                        "Sustainability is not currently a formal board agenda item. Environmental compliance is managed through standard operational processes and legal oversight.",
                        "- Investors",
                        "The company responds to basic ESG inquiries from investors and includes minimal environmental information in annual reporting. Plans to enhance disclosure are under consideration.",
                        "The company is committed to developing a sustainability strategy over the coming year, including establishing baseline measurements and evaluating appropriate targets and initiatives.",
                    ],
                ];

                // Build reasoning with references
                const reasoning = rows.map((row, rowIdx) => {
                    const companyNames = [
                        "Company Alpha",
                        "Company Beta",
                        "Company Gamma",
                        "Company Delta",
                    ];
                    return columns.map((col, colIdx) => {
                        return `Analysis based on ${companyNames[rowIdx]}'s sustainability report [^${colIdx % 4}^]. Data verified against public disclosures and third-party assessments.`;
                    });
                });

                // Source documents
                const sourceDocuments = [
                    {
                        page_content:
                            "Climate targets and carbon reduction strategies section covering emissions data, science-based targets, and transition planning across all portfolio companies.",
                        metadata: {
                            file_name: "sustainability-report-2023.pdf",
                            page: 20,
                            file_id: "sust-2023-0",
                        },
                    },
                    {
                        page_content:
                            "Water and waste management section detailing water stewardship initiatives, circular economy programs, and waste diversion metrics.",
                        metadata: {
                            file_name: "sustainability-report-2023.pdf",
                            page: 45,
                            file_id: "sust-2023-1",
                        },
                    },
                    {
                        page_content:
                            "Energy and renewables section covering electricity procurement, on-site generation, and progress toward renewable energy targets.",
                        metadata: {
                            file_name: "sustainability-report-2023.pdf",
                            page: 70,
                            file_id: "sust-2023-2",
                        },
                    },
                    {
                        page_content:
                            "Governance and stakeholder engagement section covering board oversight, sustainability committees, and stakeholder engagement practices.",
                        metadata: {
                            file_name: "sustainability-report-2023.pdf",
                            page: 95,
                            file_id: "sust-2023-3",
                        },
                    },
                ];

                sendToRenderer(
                    "output",
                    {
                        column_headers: columns,
                        rows: rows,
                        reasoning: reasoning,
                        source_documents: sourceDocuments,
                    },
                    {
                        inputs: {
                            table_question: {
                                text: "Comprehensive ESG assessment across climate, water, energy, governance and stakeholder dimensions",
                                cell_questions: cellQuestions,
                            },
                        },
                    },
                );
            }

            // Test: PerPageAnswer in LLM API response format
            function sendPerPageAnswer() {
                sendToRenderer("output", {
                    generations: [
                        [
                            {
                                generation_info: {
                                    finish_reason: "STOP",
                                    model_name: "gemini-2.5-pro",
                                    safety_ratings: [],
                                },
                                message: {
                                    id: [
                                        "langchain",
                                        "schema",
                                        "messages",
                                        "AIMessage",
                                    ],
                                    kwargs: {
                                        additional_kwargs: {},
                                        content: "",
                                        id: "run--5e7d922b-19e3-488e-ac0c-d554a56d6e79-0",
                                        invalid_tool_calls: [],
                                        response_metadata: {},
                                        tool_calls: [
                                            {
                                                args: {
                                                    answer: 'The user wants me to fill a Markdown table based on the provided text.\n\nHere\'s my analysis and the resulting table:\n\n1. **Row**: This is fixed as "Row 1".\n2. **Process in place**: The document is an "Environmental Product Design Policy" and details "implementation frameworks," "governance," and "monitoring" processes. This confirms a process is in place. So, the answer is "Yes".\n3. **Dependencies and/or impacts evaluated in this process**: The text repeatedly mentions monitoring the "environmental footprint," "biodegradability," and "packaging intensity." These are all environmental *impacts*. The text does not describe a process for evaluating environmental *dependencies* (what the company relies on from nature). Therefore, the answer is "Impacts only".\n4. **Biodiversity impacts evaluated before the mining project development stage**: The company is L\'Oral, which is in the cosmetics industry. The provided text is about product design. There is no indication of any mining activities. Therefore, this column is "N/A".\n5. **Primary reason for not evaluating dependencies and/or impacts**: This is applicable because the process only covers impacts, not dependencies. The text does not state a reason for this focus. Among the given options, "Not an immediate strategic priority" is the most plausible inference.',
                                                    chunk_uuid:
                                                        "72444162-8256-328a-ae35-b331a7969bb9",
                                                    entity_scope:
                                                        "whole_company",
                                                    evidence_snippets:
                                                        "The effective implementation of the Environmental Product Design Policy is a priority for L'Oral.\nWe focus on establishing appropriate governance, ensuring teams have the capabilities to apply the\npolicy, and tracking the effectiveness of design efforts for each Brand and Division.\n...\nMonitoring\nWe value the importance of monitoring processes to track the policy's implementation and\nachievements. The research and innovation team monitors the improvement of the formula\nenvironmental footprint, including biodegradability. The packaging and development team monitors\nthe recycled or biobased content of packaging, the packaging intensity of our products and the level\nof packaging that is designed for recycling. At Groupe level we monitor the implementation of the\npolicy, for every new product we launch or renovate. We report our progress in our Universal\nRegistration Document each year.",
                                                    is_useful: true,
                                                    reasoning:
                                                        'The user wants to know if the company has a process for identifying, assessing, and managing environmental dependencies and/or impacts.\n\n1. **Process in place**: The document is titled "Environmental Product Design Policy" and explicitly mentions "robust implementation frameworks," "governance," and "monitoring processes." This confirms a process exists.\n2. **Dependencies and/or impacts evaluated**: The "Monitoring" section details what is tracked: "formula environmental footprint, including biodegradability," "recycled or biobased content of packaging," and "packaging intensity." These are all measures of the company\'s *impacts* on the environment. The text does not mention any process for evaluating *dependencies* on environmental assets or ecosystem services.\n3. **Conclusion**: The company has a process, but based on the provided text, it focuses solely on evaluating environmental impacts.',
                                                    reporting_period: "unknown",
                                                    source_description:
                                                        "environmental-product-design-policy-environment-policy-6th-may.pdf",
                                                },
                                                id: "e9321075-93ac-4766-94cb-3fd430225857",
                                                name: "PerPageAnswer",
                                                type: "tool_call",
                                            },
                                        ],
                                        type: "ai",
                                        usage_metadata: {},
                                    },
                                    lc: 1,
                                    type: "constructor",
                                },
                                text: "",
                                type: "ChatGeneration",
                            },
                        ],
                    ],
                    llm_output: {
                        prompt_feedback: {
                            block_reason: 0,
                            safety_ratings: [],
                        },
                    },
                    run: null,
                    type: "LLMResult",
                });
            }

            // Test: LLM text response with markdown content
            function sendLLMTextResponse() {
                sendToRenderer("output", {
                    generations: [
                        [
                            {
                                generation_info: {
                                    finish_reason: "stop",
                                    model_name: "gpt-5.1-2025-11-13",
                                },
                                message: {
                                    id: [
                                        "langchain",
                                        "schema",
                                        "messages",
                                        "AIMessage",
                                    ],
                                    kwargs: {
                                        content: "",
                                        tool_calls: [],
                                    },
                                },
                                text: `# Environmental Dependencies/Impacts Assessment

## Compact Prompt Overview

You are an expert ESG disclosure assistant. Fill a Markdown table according to the specifications, column definitions, and applicability rules provided.

### Row Entity Definition

- This is a **fixed-row table** with exactly one row ("Row 1").
- "Row 1" represents the organization's overall process for identifying, assessing, and managing environmental dependencies and/or impacts.

### Fixed Columns

| Column | Description |
| --- | --- |
| Row | Fixed as "Row 1" |
| Process in place | Whether organization has a process |
| Dependencies and/or impacts evaluated | What is evaluated in the process |
| Biodiversity impacts evaluated | Mining-specific evaluation |
| Primary reason for not evaluating | Main reason if not evaluating |
| Explanation | Detailed explanation and future plans |

### Key Definitions

- **Manage**: The approach adopted by an organization to address and respond
- **Dependencies**: Aspects of environmental assets and ecosystem services that an organization relies on
- **Impacts**: Changes in the condition of nature (quality or quantity)

### Column Rules

#### Column 2  Process in place (single select)

Allowed options:
- "Yes"
- "No, but we plan to within the next two years"
- "No, and we do not plan to within the next two years"

#### Column 3  Dependencies and/or impacts evaluated

Allowed options:
- "Dependencies only"
- "Impacts only"
- "Both dependencies and impacts"

> Note: If Column 2 = any "No" option, then Column 3 should typically be "N/A".

### Output Format

\`\`\`markdown
| Row | Process in place | Dependencies and/or impacts evaluated | Biodiversity impacts evaluated | Primary reason | Explanation |
| --- | --- | --- | --- | --- | --- |
| Row 1 |  |  |  |  |  |
\`\`\`

Now complete the table following all rules above.`,
                                type: "ChatGeneration",
                            },
                        ],
                    ],
                    llm_output: {
                        id: "chatcmpl-D2ikZDAa6Q6EpMMFGneX7g2ls3o1U",
                        model_name: "gpt-5.1-2025-11-13",
                        service_tier: "default",
                        system_fingerprint: null,
                        token_usage: {
                            completion_tokens: 1903,
                            prompt_tokens: 1969,
                            total_tokens: 3872,
                        },
                    },
                    run: null,
                    type: "LLMResult",
                });
            }
        </script>
    </body>
</html>
